# $Id$

# See examples/compiler/Makefile for how to generate the needed shared lib

=head1 NAME

eval.imc - Integer arithmetic evaluation for Parrot m4

=head1 DESCRIPTION

Just a sample.

=cut

.sub _main

    # load shared lib
    # There is a init-function in the shared lib,
    # which registers the new compiler
    print "Loading shared library, let the library register the compiler\n"
    .local pmc m4_eval_compiler_lib
    m4_eval_compiler_lib = loadlib "m4_eval_compiler"

    # get compiler
    print "Getting the compiler\n"
    .local pmc m4_eval_compiler
    m4_eval_compiler = compreg "m4_eval_compiler"

    # compile code and run it
    .local string expression
    expression = '1 + 1 * 117'
    print "Evaluating expression: "
    print expression
    print "\n"
    .local pmc compiled_code
    compiled_code = compile m4_eval_compiler, expression

    print "Invoking compiled code, and receive returned expression\n"
    .local int evaluated_expression
    ( evaluated_expression ) = compiled_code()
    print "evaluated: "
    print evaluated_expression
    print "\n"
    end
.end
